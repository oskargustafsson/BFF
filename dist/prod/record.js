!function(){'use strict';function a(a,b,c){function d(a){return a instanceof Object&&a.constructor&&!Array.isArray(a)&&!a.call&&!a.apply}function e(a,b){var c=h+':'+a,d=i+':'+a;return function(e){b.setter&&(e=b.setter.call(this,e));var f=this[a];if(this.emit(h,a,f,this),this.emit(c,f,this),this.__private.values[a]=e,this[a]!==f){var g=this[a];this.emit(i,a,g,f,this),this.emit(d,g,f,this)}}}function f(a,b){return b.getter?function(){return b.getter.call(this,this.__private.values[a])}:function(){return this.__private.values[a]}}function g(a){this.__private.values={},this.__private.previousValues={};var b,c,d=this.__private.schema,e={};for(var f in d){b=d[f];var g=b.defaultValue,j=b.type;if(g instanceof Function){var k=!1;for(c=0;c<j.length;c++)if(j[c]===Function){k=!0;break}k||(g=g())}e[f]=g}for(f in a)e[f]=a[f];for(f in e){var l=e[f];d[f].setter&&(l=d[f].setter.call(this,l)),this.__private.values[f]=l}var m=function(a){var b=this.__private.previousValues[a]=this[a];this.emit(h,a,b,this),this.emit(h+':'+a,b,this)},n=function(a){var b=this.__private.previousValues[a],c=this[a];c!==b&&(this.emit(i,a,c,b,this),this.emit(i+':'+a,c,b,this))};for(f in d)if(b=d[f],b.dependencies)for(c=0;c<b.dependencies.length;++c){var o=b.dependencies[c];this.listenTo(this,h+':'+o,m.bind(this,f)),this.listenTo(this,i+':'+o,n.bind(this,f))}}var h='prechange',i='change',j='undefined'==typeof Symbol?Object.freeze({}):Symbol('ANY_TYPE');return g.prototype.toJSON=function(){var a={};for(var b in this.__private.values){var c=this[b];a[b]=c instanceof Object?c.toJSON?c.toJSON():JSON.parse(JSON.stringify(c)):c}return a},g.prototype.toString=function(){return JSON.stringify(this,void 0,2)},a(g.prototype,b),a(g.prototype,c),g.withProperties=function(a,b){var c=function(c){this.__private||Object.defineProperty(this,'__private',{writable:!0,value:{}}),this.__private.schema=a,g.call(this,c),b||Object.preventExtensions(this)};c.prototype=Object.create(g.prototype),c.prototype.constructor=c;var h={};for(var i in a){var k=a[i]=a[i]||{};d(k)||(k=a[i]={type:k}),'type'in k||(k.type=[j]),k.type instanceof Array||(k.type=[k.type]);h[i]={enumerable:!0,get:k.getter===!1?void 0:f(i,k),set:k.setter===!1?void 0:e(i,k)}}return Object.defineProperties(c.prototype,h),c},g}if('function'==typeof define&&define.amd)define(['./extend','./event-emitter','./event-listener'],a);else if('object'==typeof exports)module.exports=a(require('./extend'),require('./event-emitter'),require('./event-listener'));else{var b=window.bff=window.bff||{};b.Record=a(b.extend,b.eventEmitter,b.eventListener)}}();