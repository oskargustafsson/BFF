!function(){'use strict';function a(a,b,c){function d(a,b){var c=g+':'+a,d=h+':'+a;return function(e){b.setter&&(e=b.setter.call(this,e));var f=this[a];if(this.emit(g,a,f,this),this.emit(c,f,this),this.__private.values[a]=e,this[a]!==f){var i=this[a];this.emit(h,a,i,f,this),this.emit(d,i,f,this)}}}function e(a,b){return b.getter?function(){return b.getter.call(this,this.__private.values[a])}:function(){return this.__private.values[a]}}function f(a){if(!this.__private)throw'Record an abstract class, meant to be "subclassed" using Record.withProperties(schema)';this.__private.values={},this.__private.previousValues={};var b=this.__private.schema,c={};for(var d in b)c[d]=b[d].defaultValue;for(d in a)c[d]=a[d];for(d in c){var e=c[d];b[d].setter&&(e=b[d].setter.call(this,e)),this.__private.values[d]=e}var f=function(a){var b=this.__private.previousValues[a]=this[a];this.emit(g,a,b,this),this.emit(g+':'+a,b,this)},i=function(a){var b=this.__private.previousValues[a],c=this[a];c!==b&&(this.emit(h,a,c,b,this),this.emit(h+':'+a,c,b,this))};for(d in b){var j=b[d];if(j.dependencies)for(var k=0;k<j.dependencies.length;++k){var l=j.dependencies[k];this.listenTo(this,g+':'+l,f.bind(this,d)),this.listenTo(this,h+':'+l,i.bind(this,d))}}}var g='prechange',h='change';return f.prototype.toJSON=function(){var a={};for(var b in this.__private.values)a[b]=this[b];return a},f.prototype.toString=function(){return JSON.stringify(this)},a(f.prototype,b),a(f.prototype,c),f.withProperties=function(a,b){var c=function(c){this.__private||Object.defineProperty(this,'__private',{writable:!0,value:{}}),this.__private.schema=a,f.call(this,c),b||Object.preventExtensions(this)};c.prototype=Object.create(f.prototype),c.prototype.constructor=c;var g={};for(var h in a){var i=a[h]=a[h]||{};'string'==typeof i&&(i=a[h]={type:i}),g[h]={enumerable:!0,get:i.getter===!1?void 0:e(h,i),set:i.setter===!1?void 0:d(h,i)}}return Object.defineProperties(c.prototype,g),c},f}if('function'==typeof define&&define.amd)define(['./extend','./event-emitter','./event-listener'],a);else if('object'==typeof exports)module.exports=a(require('./extend'),require('./event-emitter'),require('./event-listener'));else{var b=window.bff=window.bff||{};b.Record=a(b.extend,b.eventEmitter,b.eventListener)}}();